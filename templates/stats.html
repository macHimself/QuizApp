{% extends "base.html" %}

{% block title %}ğŸ“Š Statistiky po okruzÃ­ch{% endblock %}

{% block content %}
  <h2>ğŸ“ˆ Statistiky odpovÄ›dÃ­ podle okruhÅ¯</h2>
  <p>PrÅ¯mÄ›rnÃ© hodnocenÃ­: <strong>{{ average }}</strong></p>

  {% if entries %}
    {% set grouped = {} %}
    {% for entry in entries %}
      {% set t = entry.topic or "NeznÃ¡mÃ½" %}
      {% if t not in grouped %}
        {% set _ = grouped.update({t: []}) %}
      {% endif %}
      {% set _ = grouped[t].append(entry) %}
    {% endfor %}

    {% for topic, group in grouped.items() %}
    <h3>
      ğŸ—‚ï¸ {{ topic }}
        <form method="post" action="{{ url_for('clear_history_topic') }}" style="display:inline;"
            onsubmit="return confirm('Opravdu smazat historii okruhu {{ topic }}?');">
          <input type="hidden" name="topic" value="{{ topic }}">
          <button type="submit" style="font-size:0.8em; margin-left: 1em;">ğŸ§¹ Smazat historii</button>
        </form>
      </h3>
      <h3>ğŸ—‚ï¸ {{ topic }}</h3>
      <table border="1" cellpadding="5" cellspacing="0" style="margin: 0 auto 2em auto; text-align: left;">
        <thead>
          <tr>
            <th>ğŸ•’ ÄŒas</th>
            <th>ğŸ§  OtÃ¡zka</th>
            <th>ğŸ¯ HodnocenÃ­</th>
            <th>ğŸ¯ğŸ¯ğŸ¯ PrÃºmÄ›r</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in group %}
            {% if entry.type == "reset" %}
              <tr>
                <td colspan="3" style="background:#eee; font-weight:bold; text-align:center;">
                  {{ entry.timestamp }} â€“ {{ entry.message }}
                </td>
              </tr>
            {% else %}
              <tr>
                <td>{{ entry.timestamp }}</td>
                <td>{{ entry.question }}</td>
                <td>{{ entry.rating }}</td>
                <td>{{ entry.average_rating }} </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}
  {% else %}
    <p>Å½Ã¡dnÃ© zÃ¡znamy zatÃ­m nejsou.</p>
  {% endif %}

  <p><a href="{{ url_for('home') }}">â¬…ï¸ ZpÄ›t na hlavnÃ­ strÃ¡nku</a></p>
{% endblock %}